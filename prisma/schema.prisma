generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String   @id @default(cuid())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  name          String
  email         String   @unique
  phone         String
  cpf           String   @unique
  age           Int
  address       String
  passwordHash  String
  role          String   @default("USER")
  tickets       Ticket[]
  orders        Order[]
  notes         AdminNote[]
  authoredNotes AdminNote[] @relation("AdminAuthor")
  adminCheckins CheckinLog[]
}

model AdminNote {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User?    @relation(fields: [userId], references: [id])
  userId    String?
  author    User     @relation("AdminAuthor", fields: [authorId], references: [id])
  authorId  String
  content   String
  tags      String?
}

model TicketType {
  id          String   @id @default(cuid())
  name        String   @unique
  description String
  priceCents  Int
  active      Boolean  @default(true)
  capacity    Int
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  tickets     Ticket[]
  orderItems  OrderItem[]
}

model Order {
  id           String      @id @default(cuid())
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  user         User        @relation(fields: [userId], references: [id])
  userId       String
  status       String   @default("PENDING")
  totalCents   Int
  items        OrderItem[]
  payment      Payment?
  tickets      Ticket[]
}

model OrderItem {
  id           String      @id @default(cuid())
  order        Order       @relation(fields: [orderId], references: [id])
  orderId      String
  ticketType   TicketType  @relation(fields: [ticketTypeId], references: [id])
  ticketTypeId String
  quantity     Int
  unitCents    Int
}

model Payment {
  id            String       @id @default(cuid())
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  order         Order        @relation(fields: [orderId], references: [id])
  orderId       String       @unique
  provider      String
  providerRef   String?
  status        String   @default("PENDING")
  method        String
  pixQrData     String?
  boletoNumber  String?
  cardLast4     String?
}

model Ticket {
  id           String   @id @default(cuid())
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  user         User     @relation(fields: [userId], references: [id])
  userId       String
  order        Order    @relation(fields: [orderId], references: [id])
  orderId      String
  type         TicketType @relation(fields: [ticketTypeId], references: [id])
  ticketTypeId String
  qrCode       String   @unique
  status       String   @default("ISSUED")
  checkedInAt  DateTime?
  checkin      CheckinLog?
}

model CheckinLog {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  ticket    Ticket   @relation(fields: [ticketId], references: [id])
  ticketId  String   @unique
  admin     User     @relation(fields: [adminId], references: [id])
  adminId   String
}

// enums removed to support sqlite
